<script src="compressor.js"></script>

<input id="compressButton" type="button" value="Compress" />
<input id="decompressButton" type="button" value="Decompress" />
<br />

<textarea id="uncompressed" cols="40" rows="40">
[
  { "key": "key1", "val": "val1" },
  { "key": "key2", "val": "val2" },
  { "key": "key3", "val": "val3" },
  { "key": "key4", "val": "val4" },
  { "key": "key5", "val": "val5" }
]
</textarea>
<textarea id="intermediate" cols="40" rows="40">
</textarea>
<textarea id="compressed" cols="40" rows="40">
</textarea>

<script>
'use strict';

var uncompressedTextarea = document.getElementById('uncompressed');
var intermediateTextarea = document.getElementById('intermediate');
var compressedTextarea = document.getElementById('compressed');
var compressButton = document.getElementById('compressButton');

function doCompress() {
  var input = uncompressedTextarea.textContent;
  var headerList = JSON.parse(input);
  var instructions = headerListToInstructions(headerList);
  var serializedInstructions = serializeInstructions(instructions);

  var inputLength = 0;
  for (var i = 0; i < headerList.length; ++i) {
    inputLength += headerList[i].key.length;
    inputLength += headerList[i].val.length;
  }
  var outputLength = serializedInstructions.length;
  var compressionRatio = inputLength / outputLength;

  var intermediate = {
    instructions: instructions,
    inputLength: inputLength,
    outputLength: outputLength,
    compressionRatio: compressionRatio
  };
  intermediateTextarea.textContent = JSON.stringify(intermediate, null, '  ');

  compressedTextarea.textContent =
    JSON.stringify(serializedInstructions, null, '  ');
}

compressButton.addEventListener('click', doCompress, false);
</script>
