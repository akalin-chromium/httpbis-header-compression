<script src="compressor.js"></script>

<input id="roundTripButton" type="button" value="Round-trip" />
<br />

<textarea id="uncompressed" cols="40" rows="40">
[
  { "key": ":host", "val": "www.google.com" },
  { "key": ":method", "val": "GET" },
  { "key": ":path", "val": "/" },
  { "key": ":scheme", "val": "https" },
  { "key": ":version", "val": "HTTP/1.1" },
  { "key": "accept", "val": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" },
  { "key": "accept-charset", "val": "ISO-8859-1,utf-8;q=0.7,*;q=0.3" },
  { "key": "accept-encoding", "val": "gzip,deflate,sdch" },
  { "key": "accept-language", "val": "en-US,en;q=0.8" },
  { "key": "cache-control", "val": "max-age=0" },
  { "key": "user-agent", "val": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.32 (KHTML, like Gecko) Chrome/27.0.1425.0 Safari/537.32" }
]
</textarea>
<textarea id="intermediate" cols="40" rows="40">
</textarea>
<textarea id="compressed" cols="40" rows="40">
</textarea>
<textarea id="intermediate2" cols="40" rows="40">
</textarea>

<textarea id="uncompressed2" cols="40" rows="40">
</textarea>


<script>
'use strict';

var uncompressedTextarea = document.getElementById('uncompressed');
var intermediateTextarea = document.getElementById('intermediate');
var compressedTextarea = document.getElementById('compressed');
var intermediate2Textarea = document.getElementById('intermediate2');
var uncompressed2Textarea = document.getElementById('uncompressed2');
var roundTripButton = document.getElementById('roundTripButton');

function doRoundTrip() {
  var input = uncompressedTextarea.textContent;
  var headerList = JSON.parse(input);
  var instructions = headerListToInstructions(headerList);
  var serializedInstructions = serializeInstructions(instructions);

  var inputLength = 0;
  for (var i = 0; i < headerList.length; ++i) {
    inputLength += headerList[i].key.length;
    inputLength += headerList[i].val.length;
  }
  var outputLength = serializedInstructions.length;
  var compressionRatio = inputLength / outputLength;

  var intermediate = {
    instructions: instructions,
    inputLength: inputLength,
    outputLength: outputLength,
    compressionRatio: compressionRatio
  };
  intermediateTextarea.textContent = JSON.stringify(intermediate, null, '  ');

  compressedTextarea.textContent =
    JSON.stringify(serializedInstructions, null, '  ');
}

roundTripButton.addEventListener('click', doRoundTrip, false);
</script>
